FROM node:22.18-alpine

#common
ARG PORT
ENV PORT=$PORT
ARG FRONTEND_URL
ENV FRONTEND_URL=$FRONTEND_URL
#db
ARG DATABASE_URL
ENV DATABASE_URL=$DATABASE_URL
#auth
ARG JWT_SECRET
ENV JWT_SECRET=$JWT_SECRET
ARG SESSION_SECRET
ENV SESSION_SECRET=$SESSION_SECRET
ARG GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET
ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET
ARG GOOGLE_REDIRECT_URI
ENV GOOGLE_REDIRECT_URI=$GOOGLE_REDIRECT_URI
#email
ARG EMAIL_SERVER_USER
ENV EMAIL_SERVER_USER=$EMAIL_SERVER_USER
ARG EMAIL_SERVER_PASSWORD
ENV EMAIL_SERVER_PASSWORD=$EMAIL_SERVER_PASSWORD
ARG EMAIL_SERVER_HOST
ENV EMAIL_SERVER_HOST=$EMAIL_SERVER_HOST
ARG EMAIL_FROM
ENV EMAIL_FROM=$EMAIL_FROM
#foreign api
ARG CURRENCY_API
ENV CURRENCY_API=$CURRENCY_API
ARG CONVERT_CURRENCY
ENV CONVERT_CURRENCY=$CONVERT_CURRENCY
ARG TRANSLATE_API
ENV TRANSLATE_API=$TRANSLATE_API
ARG TRANSLATE_KEY
ENV TRANSLATE_KEY=$TRANSLATE_KEY

WORKDIR /app

COPY package*.json ./

RUN npm ci

COPY . .

#RUN npx prisma generate
RUN npm run build
#RUN npx prisma migrate deploy

CMD ["npm", "run", "start"]
