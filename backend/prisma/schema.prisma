generator client {
	provider = "prisma-client"
	output   = "../generated/prisma"
}

datasource db {
	provider = "mongodb"
	url      = env("DATABASE_URL")
}

model User {
	id             String           @id @default(auto()) @map("_id") @db.ObjectId
	name           String           @default("")
	email          String           @unique
	emailVerified  Boolean          @default(false)
	image          String?
	password       String?          @default("")
	phone          String?
	exchange       String?
	role           String           @default("LVL3")
	total          Float?           @default(0)
	businessCard   BusinessCard?
	goals          Goal[]
	financePlanner FinancePlanner[]

	exchangeItem ExchangeItem? @relation(fields: [exchange], references: [id])

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model ExchangeItem {
	id    String             @id @default(auto()) @map("_id") @db.ObjectId
	value String             @unique
	label ExchangeItemName[]
	base  String?            @default("")
	rate  Float?             @default(1)

	user             User[]
	fromExchangeItem FinanceItem[] @relation("FromExchangeItem")
	toExchangeItem   FinanceItem[] @relation("ToExchangeItem")
	goal             Goal[]
	requiredPayments Payments[]

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model ExchangeItemName {
	id         String @id @default(auto()) @map("_id") @db.ObjectId
	label      String
	lang       String
	exchangeId String

	exchangeItem ExchangeItem @relation(fields: [exchangeId], references: [id])

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model ExpenseCategory {
	id          String                @id @default(auto()) @map("_id") @db.ObjectId
	value       String                @unique
	label       ExpenseCategoryName[]
	color       String                @default("#fff")
	financeItem FinanceItem[]

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model ExpenseCategoryName {
	id         String @id @default(auto()) @map("_id") @db.ObjectId
	label      String
	lang       String
	categoryId String

	expenseCategory ExpenseCategory @relation(fields: [categoryId], references: [id])

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model OperationCategory {
	id          String                  @id @default(auto()) @map("_id") @db.ObjectId
	value       String                  @unique
	financeItem FinanceItem[]
	label       OperationCategoryName[]

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model OperationCategoryName {
	id         String @id @default(auto()) @map("_id") @db.ObjectId
	label      String
	lang       String
	categoryId String

	operationCategory OperationCategory @relation(fields: [categoryId], references: [id])

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model FinanceItem {
	id                  String  @id @default(auto()) @map("_id") @db.ObjectId
	userId              String
	curPrice            Float
	convertedPrice      Float
	currencyFromId      String
	currencyToId        String
	expenseCategoryId   String?
	operationCategoryId String

	exchangeItemFrom  ExchangeItem      @relation("FromExchangeItem", fields: [currencyFromId], references: [value])
	exchangeItemTo    ExchangeItem      @relation("ToExchangeItem", fields: [currencyToId], references: [value])
	expenseCategory   ExpenseCategory?  @relation(fields: [expenseCategoryId], references: [value])
	operationCategory OperationCategory @relation(fields: [operationCategoryId], references: [value])

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model Notification {
	id       String  @id @default(auto()) @map("_id") @db.ObjectId
	userId   String
	isReaded Boolean @default(false)
	title    String
	text     String

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model BusinessCard {
	id          String             @id @default(auto()) @map("_id") @db.ObjectId
	userId      String             @unique
	subtitle    String?
	description String?
	socialLinks BusinessCardLink[]

	user User @relation(fields: [userId], references: [id])

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model BusinessCardLink {
	id        String  @id @default(auto()) @map("_id") @db.ObjectId
	cardId    String
	name      String
	icon      String?
	link      String
	isVisible Boolean @default(true)

	card BusinessCard @relation(fields: [cardId], references: [id], onDelete: Cascade)

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model Goal {
	id          String   @id @default(auto()) @map("_id") @db.ObjectId
	userId      String
	title       String
	untilAt     DateTime
	total       Int      @default(0)
	amount      Float    @default(0)
	exchangeId  String
	isCompleted Boolean  @default(false)

	exchangeItem ExchangeItem @relation(fields: [exchangeId], references: [value])
	user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model FinancePlanner {
	id     String @id @default(auto()) @map("_id") @db.ObjectId
	userId String

	name             String     @default("")
	commonBudget     Float      @default(0)
	remainder        Float?     @default(0)
	payments         Payments[]
	period           String?    @default("MONTH")
	customPeriodFrom DateTime   @default(now())
	customPeriodTo   DateTime   @default(now())
	isRegular        Boolean    @default(false)

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}

model Payments {
	id       String @id @default(auto()) @map("_id") @db.ObjectId
	plnnerId String

	lable      String
	amount     Float   @default(0)
	exchange   String  @default("EUR")
	isRequired Boolean @default(false)

	exchangeItem ExchangeItem   @relation(fields: [exchange], references: [value])
	planner      FinancePlanner @relation(fields: [plnnerId], references: [id], onDelete: Cascade)

	createdAt  DateTime @default(now())
	updateddAt DateTime @default(now())
}
