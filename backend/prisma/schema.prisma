generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("POSTGRES_URL")
}

model User {
    id             String           @id @default(cuid())
    name           String           @default("")
    email          String           @unique
    emailVerified  Boolean          @default(false)
    image          String?
    password       String           @default("")
    phone          String?
    exchange       String?
    role           Role             @default(LVL3)
    total          Float?
    businessCard   BusinessCard?
    goals          Goal[]
    financePlanner FinancePlanner[]
    createdAt      DateTime         @default(now())

    exchangeItem ExchangeItem? @relation(fields: [exchange], references: [value])
}

enum Role {
    ADMIN
    LVL1
    LVL2
    LVL3
}

model ExchangeItem {
    value String             @unique
    label ExchangeItemName[]
    base  String?            @default("")
    rate  Float?             @default(1)

    user             User[]
    fromExchangeItem FinanceItem[] @relation("FromExchangeItem")
    toExchangeItem   FinanceItem[] @relation("ToExchangeItem")
    goal             Goal[]
    requiredPayments Payments[]
}

model ExchangeItemName {
    id         String @id @default(cuid())
    label      String
    lang       String
    exchangeId String

    exchangeItem ExchangeItem @relation(fields: [exchangeId], references: [value])
}

model ExpenseCategory {
    value       String                @unique
    label       ExpenseCategoryName[]
    color       String                @default("#fff")
    financeItem FinanceItem[]
}

model ExpenseCategoryName {
    id         String @id @default(cuid())
    label      String
    lang       String
    categoryId String

    expenseCategory ExpenseCategory @relation(fields: [categoryId], references: [value])
}

model OperationCategory {
    value       String                  @unique
    financeItem FinanceItem[]
    label       OperationCategoryName[]
}

model OperationCategoryName {
    id         String @id @default(cuid())
    label      String
    lang       String
    categoryId String

    operationCategory OperationCategory @relation(fields: [categoryId], references: [value])
}

model FinanceItem {
    id                  String   @id @default(cuid())
    userId              String
    curPrice            Float
    convertedPrice      Float
    currencyFromId      String
    currencyToId        String
    expenseCategoryId   String?
    operationCategoryId String
    createdAt           DateTime @default(now())

    exchangeItemFrom  ExchangeItem      @relation("FromExchangeItem", fields: [currencyFromId], references: [value])
    exchangeItemTo    ExchangeItem      @relation("ToExchangeItem", fields: [currencyToId], references: [value])
    expenseCategory   ExpenseCategory?  @relation(fields: [expenseCategoryId], references: [value])
    operationCategory OperationCategory @relation(fields: [operationCategoryId], references: [value])
}

model Notification {
    id        String   @id @default(cuid())
    userId    String
    isReaded  Boolean  @default(false)
    title     String
    text      String
    createdAt DateTime @default(now())
}

model BusinessCard {
    id          String             @id @default(cuid())
    userId      String             @unique
    subtitle    String?
    description String?
    socialLinks BusinessCardLink[]

    user User @relation(fields: [userId], references: [id])
}

model BusinessCardLink {
    id        String   @id @default(cuid())
    cardId    String
    name      String
    icon      String?
    link      String
    isVisible Boolean  @default(true)
    createdAt DateTime @default(now())

    card BusinessCard @relation(fields: [cardId], references: [id], onDelete: Cascade)
}

model Goal {
    id          String   @id @default(cuid())
    userId      String
    title       String
    createdAt   DateTime @default(now())
    untilAt     DateTime
    total       Int      @default(0)
    amount      Float    @default(0)
    exchangeId  String
    isCompleted Boolean  @default(false)

    exchangeItem ExchangeItem @relation(fields: [exchangeId], references: [value])
    user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Period {
    WEEK
    MONTH
    YEAR
    SIXMONTH
    CUSTOM
}

model FinancePlanner {
    id     String @id @default(cuid())
    userId String

    name             String     @default("")
    commonBudget     Float      @default(0)
    remainder        Float?     @default(0)
    payments         Payments[]
    period           Period?    @default(MONTH)
    customPeriodFrom DateTime   @default(now())
    customPeriodTo   DateTime   @default(now())
    isRegular        Boolean    @default(false)

    createdAt DateTime @default(now())
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Payments {
    id       String @id @default(cuid())
    plnnerId String

    lable      String
    amount     Float   @default(0)
    exchange   String  @default("EUR")
    isRequired Boolean @default(false)

    exchangeItem ExchangeItem   @relation(fields: [exchange], references: [value])
    planner      FinancePlanner @relation(fields: [plnnerId], references: [id], onDelete: Cascade)
}
